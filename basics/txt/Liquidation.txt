title Liquidation

participant "Lender (browser)" as Lender
participant "Market Maker(browser)" as Maker
participant "Collateral (contract)" as Collateral
participant "Filecoin (network)" as Filecoin
participant "Loan (contract)" as Loan
participant "Market Taker (browser)" as Taker

note over Lender,Taker:Liquidation process

note over Loan: WORKING
note over Collateral: LIQUIDATION
Collateral-->Maker:Emit message 'Nominated\nas liquidation provider'
Maker->Filecoin: Transfer Filecoin (FIL)
Maker->Loan: Input Filecoin txHash
Loan-->Lender:Emit message:\n'FIL RETURNED'
Lender-->Filecoin: Verify the amount from txHash

Lender->Loan:Confirm FIL paid
Loan->Collateral: Call to release collateral for\nFIL coupon amt (in ETH120%)
Collateral->Maker:Release collateral (in ETH120%)\nLoan state 'EMPTY'
note over Collateral:EMPTY
Collateral-->Collateral: Reserve (ETH 5%)\nmanagement fee
Collateral->Loan:Loan state 'TERMINATED'
note over Loan:TERMINATED
Loan-->Taker:Emit message\n'TERMINATED'
